# AstrBot Chat Pro Plugin 🌟

一个简洁高效的 AstrBot 插件，支持 LLM 通过关键词自主撤回消息。

## 功能特性 ✨

### LLM 自主撤回 🔄
- AI 只需发送 `[recall]` 就能撤回上一条消息
- 同时自动撤回 `[recall]` 关键词本身，保持聊天整洁
- 无需复杂配置，简单易用

### 手动管理 📝
- `/recall` - 手动撤回上一条消息
- `/list_messages` - 查看消息历史
- `/help` - 查看使用帮助

## 快速开始 🚀

### 1. 安装插件
将插件放入 AstrBot 的插件目录并启用。

### 2. 配置 AI 人格
在你的 AI 人格提示词中添加：

```
当你需要撤回上一条消息时，发送 [recall]
```

就这么简单！

### 3. 使用示例

```
用户：1+1等于几？
AI：1+1等于3
AI：[recall]
[两条消息都被自动撤回]
AI：抱歉，1+1等于2
```

## 工作原理 🔧

1. **自动监听**：插件监听所有消息，检测 `[recall]` 关键词
2. **记录消息**：自动记录每条发送的消息 ID
3. **双重撤回**：撤回上一条消息 + `[recall]` 本身
4. **保持整洁**：撤回后不留痕迹，用户体验更好

## 支持的平台 🌐

- ✅ QQ (通过 aiocqhttp)
- ⏳ 其他平台开发中...

## 配置示例 📋

### 基础配置
在 AI 人格的 system_prompt 中添加：
```
当你需要撤回上一条消息时，发送 [recall]
```

### 详细配置
你可以添加更具体的使用场景：
```
你拥有撤回消息的能力。在以下情况下，你应该发送 [recall] 来撤回上一条消息：
1. 发送了错误或不准确的信息
2. 违反了对话规则
3. 包含不当内容
4. 需要重新组织表达

使用方法：发送 [recall] 即可撤回上一条消息和 [recall] 本身。
撤回后应立即重新发送正确的内容。
```

## 常见问题 ❓

**Q: 为什么撤回失败？**
A: 请检查：
1. 确保使用支持的平台（目前仅支持 aiocqhttp）
2. 确认机器人有撤回消息的权限
3. 消息可能已超过平台的撤回时间限制（通常 2 分钟）

**Q: [recall] 会被撤回吗？**
A: 会！插件会自动撤回上一条消息和 `[recall]` 本身，保持聊天整洁。

**Q: 可以撤回更早的消息吗？**
A: 目前只支持撤回上一条消息。如需撤回更早的消息，请多次发送 `[recall]`。

## 技术细节 🔍

- **消息记录**：使用 `@filter.after_message_sent()` 钩子自动记录
- **关键词检测**：使用 `@filter.event_message_type()` 监听所有消息
- **平台 API**：调用 `delete_msg` API 实现撤回
- **存储方式**：内存存储，每个会话最多保存 20 条消息记录

## 更新日志 📅

### v1.0.0 (2026-01-14)
- ✨ 首次发布
- ✅ 支持通过 `[recall]` 关键词撤回
- ✅ 自动撤回关键词本身
- ✅ 支持手动撤回命令

## 贡献 🤝

欢迎提交 Issue 和 Pull Request！

## 许可证 📄

MIT License

## 作者 ✍️

- **Twinkle**
- GitHub: [joy040216-create](https://github.com/joy040216-create)

## 致谢 🙏

感谢 [AstrBot](https://github.com/AstrBotDevs/AstrBot) 团队提供的优秀框架！

---

如有问题或建议，欢迎在 [GitHub Issues](https://github.com/joy040216-create/astrbot_plugin_chat_pro/issues) 中反馈。
